<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lemur-EchoMeP2P-Receiver</title>
    <link rel="stylesheet" href="mobile-style.css" />
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    
    <style>
        /* 🚫 TELA DE BLOQUEIO INICIAL */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: white;
            text-align: center;
            font-family: Arial, sans-serif;
        }
        
        .loading-logo {
            width: 120px;
            height: 120px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        .loading-text {
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .loading-subtext {
            font-size: 14px;
            opacity: 0.8;
            max-width: 80%;
            line-height: 1.4;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* 🚫 ESCONDE TUDO ATÉ LIBERAR */
        .hidden-until-ready {
            display: none !important;
        }
    </style>
</head>
<body>
    
    <!-- 🚫 TELA DE CARREGAMENTO/CONFIRMAÇÃO -->
    <div id="loadingScreen">
        <img src="assets/images/lemurp2p.png" alt="Lemur Logo" class="loading-logo">
        <div class="loading-text">Lemur EchoMe P2P</div>
        <div class="loading-subtext">
            Aguarde...<br>
            O aplicativo será iniciado em instantes
        </div>
    </div>
    
    <!-- ✅ CONTEÚDO PRINCIPAL (ESCONDIDO INICIALMENTE) -->
    <div class="box-principal hidden-until-ready">
                      
        <img src="assets/images/lemurp2p.png" alt="Lemur Logo" class="logo">
        <img src="assets/images/Bridg.png" alt="ponte" class="ponte">
        <img id="logo-traduz" src="assets/images/TradGlobo.png" alt="logo-traduz">
        <img id="lemurFixed" src="" style="display: none;" onerror="this.style.display='none'" alt="">
        
        <!-- Sub Titulo --> 
        <div class="translator-label" id="translator-label">
            Real-time translation.
        </div>
           
      <!-- Remoto & Local -->
    <div class="remoter-Lang">🏳️</div>
    <div class="local-Lang">🏳️</div>
    
    <!-- 🎥 Vídeo remoto (já existente) -->
    <div class="video-wrapper">
        <video id="remoteVideo" autoplay playsinline></video>

        <!-- 🎥 Vídeo local em PiP -->
        <div class="pip-local-wrapper">
            <video id="localVideo" autoplay muted playsinline></video>
        </div>
    </div>

        <!-- 🧾 Overlay com QR Code -->
        <div class="info-overlay"> 
            <h2 id="qr-modal-title">This is your online key</h2>
            <div id="qrcode" class="qrcode-container"></div>
            <p class="qr-modal-description" id="qr-modal-description">
                You can ask to scan, share or print on your business card.
            </p>
        </div>
        
        <!-- ===== TRADUTOR POR VOZ ===== -->
        
        <!-- Caixa de Texto -->
        <div class="text-box">
            <div class="text-display">
                <div class="text-title">
                    🌐
                    <button class="speaker-btn" id="speakerButton" disabled>🔊</button>
                </div>
                <div id="translatedText" class="text-content">🎤</div>
            </div>
        </div>

        <div id="texto-recebido"></div>

        <!-- 🏳️ Bandeira +  Microfone-->
        
        <!-- 🏳️ Bandeira -->
        <div class="language-flag" id="currentLanguageFlag">🇧🇷</div>

        <!-- 🎤 Microfone -->
        <button class="record-btn" id="recordButton" disabled>🎤</button>

        <!-- 🌍 Mundinho + Dropdown juntos -->
        <div class="world-wrapper">
            <button class="world-btn" id="worldButton">
                <img src="assets/images/GloboLang.png" alt="Idioma" class="world-image">
            </button>

            <div class="language-dropdown" id="languageDropdown">
                <div class="language-option" data-lang="pt-BR">🇧🇷</div>
                <div class="language-option" data-lang="en">🇺🇸</div>
                <div class="language-option" data-lang="es">🇪🇸</div>
                <div class="language-option" data-lang="fr">🇫🇷</div>
                <div class="language-option" data-lang="de">🇩🇪</div>
                <div class="language-option" data-lang="it">🇮🇹</div>
                <div class="language-option" data-lang="ja">🇯🇵</div>
            </div>
        </div>
             
    </div>

    <!-- Modal de gravação -->
    <div class="recording-modal hidden-until-ready" id="recordingModal">
        <div class="recording-indicator">
            <div class="recording-dot"></div>
            <div class="recording-text">●</div>
            <div class="recording-timer" id="recordingTimer">0:00</div>
        </div>
        <button class="send-button" id="sendButton">📤</button>
    </div>

    <!-- 🔌 Scripts -->
    <script src="https://lemur-signal-ings.onrender.com/socket.io/socket.io.js"></script>
    
    <script>
        // ✅ FUNÇÃO GLOBAL PARA LIBERAR A INTERFACE
        window.liberarInterface = function() {
            console.log('✅ Liberando interface...');
            
            // Remove tela de loading
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.style.display = 'none';
            }
            
            // Mostra conteúdo principal
            const elementosEscondidos = document.querySelectorAll('.hidden-until-ready');
            elementosEscondidos.forEach(elemento => {
                elemento.classList.remove('hidden-until-ready');
            });
            
            console.log('✅ Interface liberada com sucesso!');
        };
        
        // ✅ SE HOUVER ERRO, MOSTRA MENSAGAM
        window.mostrarErroCarregamento = function(mensagem) {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">❌</div>
                        <div class="loading-text">Erro no Carregamento</div>
                        <div class="loading-subtext">${mensagem}</div>
                        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: white; color: #667eea; border: none; border-radius: 10px; cursor: pointer;">
                            Tentar Novamente
                        </button>
                    </div>
                `;
            }
        };
    </script>
    
    <script type="module" src="./js/receiver/receiver-ui.js"></script>
    <script src="./js/receiver/receiver-trz.js"></script>
</body>
</html>
